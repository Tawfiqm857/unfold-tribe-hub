import{h as C,r as t,j as s,n as A,B as h,A as F,t as E,v as M,w as r,x as m}from"./index-D6oOpJz6.js";import{C as q,c as S}from"./card-bNXMIAJA.js";import{P as L}from"./plus-DSTSTUho.js";const B=()=>{const{user:o}=C(),[_,g]=t.useState([]),[p,d]=t.useState({}),[u,f]=t.useState({}),[j,N]=t.useState(!0);t.useEffect(()=>{(async()=>{try{const{data:l,error:i}=await r.from("profiles").select("user_id, full_name, avatar_url, bio").neq("user_id",o==null?void 0:o.id).limit(12);if(i)throw i;g(l||[]);const w=(l||[]).map(n=>n.user_id);if(w.length){const{data:n,error:v}=await r.from("follows").select("following_id");if(!v&&n){const a={};n.forEach(c=>{a[c.following_id]=(a[c.following_id]||0)+1}),d(a)}if(o!=null&&o.id){const{data:a,error:c}=await r.from("follows").select("following_id").eq("follower_id",o.id).in("following_id",w);if(!c&&a){const x={};a.forEach(y=>{x[y.following_id]=!0}),f(x)}}}}catch(l){m({title:"Failed to load community",description:l.message,variant:"destructive"})}finally{N(!1)}})()},[o==null?void 0:o.id]);const b=async e=>{if(!(o!=null&&o.id))return m({title:"Login required",description:"Please login to follow."});try{if(u[e]){const{error:l}=await r.from("follows").delete().eq("follower_id",o.id).eq("following_id",e);if(l)throw l;f(i=>({...i,[e]:!1})),d(i=>({...i,[e]:Math.max(0,(i[e]||1)-1)}))}else{const{error:l}=await r.from("follows").insert([{follower_id:o.id,following_id:e}]);if(l)throw l;f(i=>({...i,[e]:!0})),d(i=>({...i,[e]:(i[e]||0)+1}))}}catch(l){m({title:"Action failed",description:l.message,variant:"destructive"})}};return j?s.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:s.jsx(A,{className:"w-6 h-6 animate-spin"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Community"}),s.jsxs(h,{className:"btn-hero",children:[s.jsx(L,{className:"w-4 h-4 mr-2"}),"Connect"]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_.map(e=>s.jsx(q,{className:"card-hover",children:s.jsxs(S,{className:"p-6 text-center",children:[s.jsxs(F,{className:"w-16 h-16 mx-auto mb-4",children:[s.jsx(E,{src:e.avatar_url||void 0,alt:e.full_name||"Member",loading:"lazy"}),s.jsx(M,{children:(e.full_name||"U").charAt(0)})]}),s.jsx("h3",{className:"font-semibold",children:e.full_name||"Member"}),s.jsx("p",{className:"text-muted-foreground text-sm",children:e.bio||"Unfold Tribe Nigeria"}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:[p[e.user_id]||0," followers"]}),s.jsx(h,{size:"sm",className:"mt-4",onClick:()=>b(e.user_id),children:u[e.user_id]?"Following":"Follow"})]})},e.user_id))})]})};export{B as default};
