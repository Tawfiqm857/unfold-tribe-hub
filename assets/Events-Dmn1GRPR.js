import{h as z,r as m,j as e,n as L,B as x,s as u,q as b,p as g,A as k,t as A,v as G,w as o,x as N}from"./index-D6oOpJz6.js";import{C as r,c,a as y,b as _}from"./card-bNXMIAJA.js";import{P as O}from"./plus-DSTSTUho.js";import{M as S}from"./map-pin-Vxny5efK.js";import{C as q}from"./clock-CnbXBpP0.js";import{F}from"./filter-D2StHfn-.js";const Y=()=>{const{user:a}=z(),[f,C]=m.useState("list"),[D,E]=m.useState(!0),[n,h]=m.useState([]),[d,j]=m.useState({});m.useEffect(()=>{(async()=>{try{const t=new Date().toISOString(),{data:l,error:i}=await o.from("events").select("*").gte("starts_at",t).order("starts_at",{ascending:!0});if(i)throw i;if(h(l||[]),a!=null&&a.id){const v=(l||[]).map(p=>p.id);if(v.length){const{data:p}=await o.from("event_rsvps").select("event_id").eq("user_id",a.id).in("event_id",v),w={};(p||[]).forEach(R=>{w[R.event_id]=!0}),j(w)}}}catch(t){N({title:"Failed to load events",description:t.message,variant:"destructive"})}finally{E(!1)}})()},[a==null?void 0:a.id]);const P=async s=>{if(!(a!=null&&a.id))return N({title:"Login required",description:"Please login to RSVP."});try{if(d[s]){const{error:t}=await o.from("event_rsvps").delete().eq("event_id",s).eq("user_id",a.id);if(t)throw t;j(l=>({...l,[s]:!1})),h(l=>l.map(i=>i.id===s?{...i,attendees_count:Math.max(0,i.attendees_count-1)}:i))}else{const{error:t}=await o.from("event_rsvps").insert([{event_id:s,user_id:a.id}]);if(t)throw t;j(l=>({...l,[s]:!0})),h(l=>l.map(i=>i.id===s?{...i,attendees_count:i.attendees_count+1}:i))}}catch(t){N({title:"RSVP failed",description:t.message,variant:"destructive"})}},V=n.slice(0,3).map(s=>({title:s.title,date:new Date(s.starts_at).toLocaleDateString("en-NG",{month:"short",day:"2-digit"}),attendees:s.attendees_count}));return D?e.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:e.jsx(L,{className:"w-6 h-6 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Events"}),e.jsx("p",{className:"text-muted-foreground",children:"Discover and join Nigerian events"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",onClick:()=>C(f==="list"?"calendar":"list"),children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),f==="list"?"Calendar View":"List View"]}),e.jsxs(x,{className:"btn-hero",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Create Event"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsxs(c,{className:"p-6 text-center",children:[e.jsx(u,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("p",{className:"text-2xl font-bold",children:n.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upcoming"})]})}),e.jsx(r,{children:e.jsxs(c,{className:"p-6 text-center",children:[e.jsx(b,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-2xl font-bold",children:n.reduce((s,t)=>s+t.attendees_count,0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Attendees"})]})}),e.jsx(r,{children:e.jsxs(c,{className:"p-6 text-center",children:[e.jsx(S,{className:"w-8 h-8 mx-auto mb-2 text-purple-500"}),e.jsx("p",{className:"text-2xl font-bold",children:new Set(n.map(s=>s.city||s.location||"Online")).size}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Locations"})]})}),e.jsx(r,{children:e.jsxs(c,{className:"p-6 text-center",children:[e.jsx(q,{className:"w-8 h-8 mx-auto mb-2 text-orange-500"}),e.jsx("p",{className:"text-2xl font-bold",children:n.filter(s=>new Date(s.starts_at).toDateString()===new Date().toDateString()).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Today"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(r,{children:e.jsx(c,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(F,{className:"w-4 h-4 text-muted-foreground"}),["All","Virtual","In-Person","This Week","Free","Paid"].map(s=>e.jsx(g,{variant:"outline",className:"cursor-pointer hover:bg-accent",children:s},s))]})})}),e.jsx("div",{className:"space-y-4",children:n.map(s=>e.jsx(r,{className:"card-hover",children:e.jsxs("div",{className:"md:flex",children:[e.jsx("div",{className:"md:w-1/3",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=800&h=400&fit=crop",alt:s.title,loading:"lazy",className:"w-full h-48 md:h-full object-cover rounded-l-lg"})}),e.jsxs("div",{className:"md:w-2/3 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex gap-2",children:(s.tags||[]).map(t=>e.jsx(g,{variant:"secondary",className:"text-xs",children:t},t))}),e.jsx(x,{variant:d[s.id]?"default":"outline",size:"sm",className:d[s.id]?"btn-glow":"",onClick:()=>P(s.id),children:d[s.id]?"Going":"RSVP"})]}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.starts_at).toLocaleString("en-NG")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:s.is_virtual?"Online":s.location||`${s.city||""} ${s.state||""}`})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.attendees_count,s.max_attendees?`/${s.max_attendees}`:""," attending"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{className:"w-6 h-6",children:[e.jsx(A,{src:void 0,alt:"Organizer",loading:"lazy"}),e.jsx(G,{children:"NG"})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"by Organizer"})]}),e.jsx(x,{variant:"ghost",size:"sm",children:"View Details"})]})]})]})},s.id))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(r,{children:[e.jsx(y,{children:e.jsx(_,{children:"Your RSVPs"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-3",children:[Object.keys(d).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No RSVPs yet"}),n.filter(s=>d[s.id]).slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.starts_at).toLocaleString("en-NG")})]}),e.jsx(g,{variant:"default",className:"text-xs",children:"Going"})]},s.id))]})})]}),e.jsxs(r,{children:[e.jsx(y,{children:e.jsx(_,{children:"Upcoming Events"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:V.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.date})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.attendees," going"]})})]},t))})})]}),e.jsx(r,{className:"bg-gradient-primary text-white",children:e.jsxs(c,{className:"p-6 text-center",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Host Your Event"}),e.jsx("p",{className:"text-white/80 text-sm mb-4",children:"Share your knowledge and connect with the community"}),e.jsx(x,{variant:"secondary",size:"sm",className:"bg-white text-primary hover:bg-white/90",children:"Get Started"})]})})]})]})]})};export{Y as default};
